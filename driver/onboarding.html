<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Driver onboarding | No 5 Tyre</title>
  <link rel="stylesheet" href="../styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { theme: { extend: { colors: { safety: '#fede00' } } } }</script>
</head>
<body class="bg-zinc-900 text-zinc-200 antialiased min-h-screen page-loaded">
  <header class="bg-zinc-900 border-b border-zinc-700">
    <div class="max-w-2xl mx-auto px-4 py-6">
      <h1 class="text-xl font-bold text-white">Driver onboarding</h1>
      <p class="text-zinc-400 text-sm mt-1">Sign up to receive job assignments and payouts via Stripe.</p>
    </div>
  </header>

  <main class="max-w-2xl mx-auto px-4 py-8">
    <div id="step-form" class="rounded-2xl border border-zinc-700 bg-zinc-800/50 p-6 space-y-6">
      <h2 class="text-lg font-semibold text-white">Your details</h2>
      <form id="driver-register-form" class="space-y-4">
        <div>
          <label for="name" class="block text-sm font-medium text-zinc-300 mb-1">Full name *</label>
          <input type="text" id="name" name="name" required class="w-full px-4 py-3 rounded-lg bg-zinc-700 border border-zinc-600 text-white focus:border-safety focus:outline-none" placeholder="John Smith">
        </div>
        <div>
          <label for="email" class="block text-sm font-medium text-zinc-300 mb-1">Email *</label>
          <input type="email" id="email" name="email" required class="w-full px-4 py-3 rounded-lg bg-zinc-700 border border-zinc-600 text-white focus:border-safety focus:outline-none" placeholder="john@example.com">
        </div>
        <div>
          <label for="phone" class="block text-sm font-medium text-zinc-300 mb-1">Phone *</label>
          <input type="tel" id="phone" name="phone" required class="w-full px-4 py-3 rounded-lg bg-zinc-700 border border-zinc-600 text-white focus:border-safety focus:outline-none" placeholder="07895 859505">
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-zinc-300 mb-1">Password *</label>
          <input type="password" id="password" name="password" required minlength="8" class="w-full px-4 py-3 rounded-lg bg-zinc-700 border border-zinc-600 text-white focus:border-safety focus:outline-none" placeholder="Min 8 characters">
        </div>
        <div>
          <label for="pin" class="block text-sm font-medium text-zinc-300 mb-1">PIN (4â€“6 digits, optional)</label>
          <input type="password" id="pin" name="pin" pattern="[0-9]{4,6}" maxlength="6" inputmode="numeric" class="w-full px-4 py-3 rounded-lg bg-zinc-700 border border-zinc-600 text-white focus:border-safety focus:outline-none" placeholder="Quick login on mobile">
        </div>
        <hr class="border-zinc-700">
        <h3 class="text-base font-semibold text-white">Driving licence</h3>
        <div>
          <label for="license_number" class="block text-sm font-medium text-zinc-300 mb-1">Licence number *</label>
          <input type="text" id="license_number" name="license_number" required class="w-full px-4 py-3 rounded-lg bg-zinc-700 border border-zinc-600 text-white focus:border-safety focus:outline-none" placeholder="SMITH801010AB5CE">
        </div>
        <hr class="border-zinc-700">
        <h3 class="text-base font-semibold text-white">Van / vehicle</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label for="van_make" class="block text-sm font-medium text-zinc-300 mb-1">Van make & model *</label>
            <input type="text" id="van_make" name="van_make" required class="w-full px-4 py-3 rounded-lg bg-zinc-700 border border-zinc-600 text-white focus:border-safety focus:outline-none" placeholder="Ford Transit">
          </div>
          <div>
            <label for="van_reg" class="block text-sm font-medium text-zinc-300 mb-1">Registration *</label>
            <input type="text" id="van_reg" name="van_reg" required class="w-full px-4 py-3 rounded-lg bg-zinc-700 border border-zinc-600 text-white focus:border-safety focus:outline-none" placeholder="AB12 CDE">
          </div>
        </div>
        <p id="form-status" class="text-sm hidden"></p>
        <button type="submit" id="submit-btn" class="w-full px-4 py-3 bg-safety text-zinc-900 font-bold rounded-lg hover:bg-[#e5c900] focus:outline-none focus:ring-2 focus:ring-safety">
          Create account & continue to Stripe
        </button>
      </form>
    </div>
  </main>

  <script>
  (function() {
    var form = document.getElementById('driver-register-form');
    var status = document.getElementById('form-status');
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      status.classList.add('hidden');
      var btn = document.getElementById('submit-btn');
      btn.disabled = true;
      var payload = {
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.replace(/\D/g, ''),
        password: document.getElementById('password').value,
        license_number: document.getElementById('license_number').value.trim(),
        van_make: document.getElementById('van_make').value.trim(),
        van_reg: document.getElementById('van_reg').value.trim().toUpperCase().replace(/\s/g, '')
      };
      var pin = document.getElementById('pin').value;
      if (pin) payload.pin = pin;
      fetch('api/register.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).then(function(r) { return r.json(); }).then(function(d) {
        if (d.url) {
          window.location.href = d.url;
        } else {
          status.textContent = d.error || 'Something went wrong.';
          status.classList.remove('hidden', 'text-green-400');
          status.classList.add('text-red-400');
          btn.disabled = false;
        }
      }).catch(function() {
        status.textContent = 'Network error. Try again.';
        status.classList.remove('hidden', 'text-green-400');
        status.classList.add('text-red-400');
        btn.disabled = false;
      });
    });
  })();
  </script>
</body>
</html>
